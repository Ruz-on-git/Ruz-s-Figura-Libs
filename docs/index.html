<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BBModel Baker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <link rel="stylesheet" href="./css/styles.css" />

    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

<div class="sidebar">
    <div class="tabs">
        <button class="tab active" onclick="switchTab('main')">Files</button>
        <button class="tab" onclick="switchTab('config')">Config</button>
    </div>

    <div id="panel-main" class="panel active">
        <div>
            <label>1. Load Model (.bbmodel)</label>
            <div style="display:flex; gap:5px;">
                <input type="file" id="fileInput" accept=".bbmodel,.json" style="flex:1;">
            </div>
            <button id="btnLoad" py-click="load_model" style="margin-top:12px">Load & Parse</button>
        </div>
        
        <div style="display:flex; flex-direction:column; flex:1; overflow:hidden;">
            <label>Select Animations</label>
            <div id="anim-list-container">
                <div style="padding:40px 20px; text-align:center; color:#555; font-style:italic;">No model loaded</div>
            </div>
        </div>
        
        <button id="btnBake" py-click="bake_selected" disabled>Bake Selected to ZIP</button>
    </div>

    <div id="panel-config" class="panel">
        <div class="row">
            <div class="col"><label>Ticks</label><input type="number" id="cfg_ticks" value="20"></div>
            <div class="col"><label>Chunk Size</label><input type="number" id="cfg_chunk" value="100"></div>
            <div class="col"><label>Precision</label><input type="number" id="cfg_prec" value="1000"></div>
        </div>
        
        <div style="flex:1; display:flex; flex-direction:column; min-height:0;">
            <div class="flex-between" style="margin-bottom:8px;">
                <label style="margin:0">Part Mapping</label>
                <div style="display:flex; gap:6px;">
                    <button class="secondary btn-small" onclick="addInternalPart()" title="Add Internal Part">+ Part</button>
                    <button class="secondary btn-small" onclick="addRole()" title="Add Role Column">+ Role</button>
                </div>
            </div>

            <div id="partmap-wrapper">
                <table id="partmap-table">
                    <thead id="partmap-head"></thead>
                    <tbody id="partmap-body"></tbody>
                </table>
            </div>
        </div>

        <div><label>Settings (Array)</label><textarea id="cfg_settings" rows="2"></textarea></div>
        <div><label>Cameras (JSON)</label><textarea id="cfg_cameras" rows="4"></textarea></div>
        <button class="secondary" py-click="reset_config">Reset to Defaults</button>
    </div>

    <div id="console">Initializing Python...</div>
</div>

<div class="viewport" id="viewport"><div id="overlay">Preview</div></div>

<script src="./js/ui.js"></script>
<script type="module" src="./js/viewer.js"></script>

<script type="py" src="./py/baker.py"></script>

</body>
</html>